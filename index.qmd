---
title: "Indo al√©m na organiza√ß√£o de dados usando o R com tidyverse"
author: "Beatriz Milz"
date: "XVIII Congresso Brasileiro de Limnologia | Outubro 2022   <br><br> Slides: **beatrizmilz.github.io/2022-cblimnologia** "
format: 
  revealjs:
   # logo: "images/logo.png"
    width: 1600
    height: 900
    self-contained: false
    incremental: false
    footer: "Slides por [Beatriz Milz](https://beamilz.com) (@BeaMilz), feito com  [Quarto](https://quarto.org/docs/presentations/revealjs/index.html). C√≥digo dispon√≠vel no [GitHub](https://github.com/beatrizmilz/2022-cblimnologia)."
    theme: ["custom.scss"]
    slide-number: c/t
    show-slide-number: all
    hash-type: number
    preview-links: false
knitr:
  opts_chunk: 
    message: false
    warning: false
    fig.align: "center"
    eval: true
    include: true
    echo: true
---

## Beatriz Milz üáßüá∑ {.center .aboutmeslide}

::: columns
::: {.column width="60%"}
-   Contato

    -   Twitter: [\@BeaMilz](https://twitter.com/BeaMilz)

    -   Blog: [beamilz.com](https://beamilz.com)

-   Sobre mim

    -   Co-organizadora: R-Ladies S√£o Paulo / Latin-R / satRday S√£o Paulo

    -   Professora na [Curso-R](https://curso-r.com/)

    -   Instrutora de Tidyverse certificada pela RStudio
:::

::: {.column width="40%"}
![](images/octocat-1656339210373.png)
:::
:::


```{r}
#| echo: false
source("utils.R")
```


## Forma√ß√£o

  - 2012 - 2015 - Gest√£o Ambiental - EACH/USP

  - 2016 - 2018 - UNIFESP/Diadema - Mestrado - An√°lise Ambiental Integrada

  - 2019 - atualmente - IEE/USP - Ci√™ncia Ambiental

- Sobre a forma√ß√£o: <https://beatrizmilz.github.io/slidesR/pessoal/09-2021-UFV.html>

- Primeiro artigo como primeira autora, derivado do mestrado: 
  - [Ambi-Agua](http://www.ambi-agua.net/seer/index.php/ambi-agua/article/view/2402)
  - [C√≥digo](https://github.com/beatrizmilz/ambi-agua-2823)



## Tarefas iniciais

Caso n√£o tenha, crie uma conta no servi√ßo:

-   RStudio Cloud: <https://rstudio.cloud/>

Dica: Voc√™ pode criar uma conta vinculada ao Gmail ou GitHub.

## Objetivos de aprendizagem

-   O minicurso √© destinado a pessoas que j√° tem um conhecimento b√°sico sobre tidyverse e dplyr (como selecionar colunas, filtrar linhas, ordenar linhas, agrupar e sumarizar) e querem aprender mais.

-   O foco minicurso ser√° realizado com exemplos pr√°ticos.

-   Falaremos sobre boas pr√°ticas tamb√©m!

## tidyverse

```{r}
#| results: 'asis'
#| echo: false
adicionar_arte_horst("tidyverse_celestial")
```



# Sobre esse tutorial....

## Faremos muita pr√°tica!

![](images/livecoding.jpg){fig-align="center"}

::: footer
Arte por [Allison Horst](https://mobile.twitter.com/allison_horst)
:::


## Tem novidades surgindo com frequ√™ncia!

![](images/something-new.jpg){fig-align="center"}

::: footer
Arte por [Allison Horst](https://mobile.twitter.com/allison_horst)
:::


## Reprodutibilidade

```{r}
#| results: 'asis'
#| echo: false
adicionar_arte_horst("reproducibility_court")
```


## Vamos usar um projeto do RStudio

```{r}
#| results: 'asis'
#| echo: false
adicionar_arte_horst("cracked_setwd")
```


## Dicas gerais

::: incremental
-   N√£o use caracteres especiais para nomear arquivos, pastas, vari√°veis, colunas, fun√ß√µes, e por a√≠ vai!

-   Use projetos do RStudio. Crie um `.Rproj` para cada projeto. Dentro deste projeto, guarde de forma organizada os arquivos relacionados √† este projeto.

-   Tenha uma pasta de dados brutos (ex. `data-raw/`) e dados tratados (ex. `data/`). N√ÉO MISTURE!

-   Sempre que receber/baixar uma nova base de dados, N√ÉO FA√áA ALTERA√á√ïES MANUALMENTE NOS DADOS BRUTOS!

-   Pense sempre na reprodutibilidade :)
:::

## Conceito importante: tidy data


```{r}
#| results: 'asis'
#| echo: false
adicionar_arte_horst("tidydata_1", ext = ".jpg", legenda_complementar = "Illustrations from the [Openscapes](https://www.openscapes.org/) blog [*Tidy Data for reproducibility, efficiency, and collaboration*](https://www.openscapes.org/blog/2020/10/12/tidy-data/) by Julia Lowndes and Allison Horst.")
```


## Conceito importante: tidy data


```{r}
#| results: 'asis'
#| echo: false
adicionar_arte_horst("tidydata_2", ext = ".jpg", legenda_complementar = "Illustrations from the [Openscapes](https://www.openscapes.org/) blog [*Tidy Data for reproducibility, efficiency, and collaboration*](https://www.openscapes.org/blog/2020/10/12/tidy-data/) by Julia Lowndes and Allison Horst.")
```



## Conceito importante: tidy data

```{r}
#| results: 'asis'
#| echo: false
adicionar_arte_horst("tidydata_3", ext = ".jpg", legenda_complementar = "Illustrations from the [Openscapes](https://www.openscapes.org/) blog [*Tidy Data for reproducibility, efficiency, and collaboration*](https://www.openscapes.org/blog/2020/10/12/tidy-data/) by Julia Lowndes and Allison Horst.")
```


## Conceito importante: tidy data


```{r}
#| results: 'asis'
#| echo: false
adicionar_arte_horst("tidydata_7", ext = ".jpg", legenda_complementar = "Illustrations from the [Openscapes](https://www.openscapes.org/) blog [*Tidy Data for reproducibility, efficiency, and collaboration*](https://www.openscapes.org/blog/2020/10/12/tidy-data/) by Julia Lowndes and Allison Horst.")
```

## Dados

-   A base de dados que usaremos foi extra√≠da do sistema INFOAGUAS/ [CETESB](https://sistemainfoaguas.cetesb.sp.gov.br/AguasSuperficiais/RelatorioQualidadeAguasSuperficiais/Monitoramento)

-   Dados de qualidade de √°guas superficiais no Estado de SP.

-   Filtro usado: pontos relacionados com o reservat√≥rio Billings!

## importando v√°rios arquivos de uma vez

**Importando a base de dados:**

```{r}
#| include: true
#| 
dados_infoaguas <- readr::read_rds("dados/infoaguas_results_billings.Rds")
```

## Conhecendo a base de dados

```{r}
dplyr::glimpse(dados_infoaguas)
```

**Informa√ß√µes √∫teis:** quais vari√°veis temos? qual √© o nome das colunas? qual √© o tipo das colunas?

**Outras perguntas:** Qual √© o formato da base de dados? Qual √© a unidade amostral (o que cada linha representa)?

## Quais par√¢metros temos na base?

```{r}
dados_infoaguas |> 
  dplyr::count(parametro, sort = TRUE) |> 
  dplyr::mutate(porc = n/nrow(dados_infoaguas))
```

## Arrumar o nome das colunas utilizando padr√µes

```{r}
#| results: 'asis'
#| echo: false
adicionar_arte_horst("janitor_clean_names")
```

## Criar novas colunas a partir dos dados

```{r}
#| results: 'asis'
#| echo: false
adicionar_arte_horst("dplyr_mutate")
```


## Criar novas colunas a partir dos dados

```{r}
#| results: 'asis'
#| echo: false
adicionar_arte_horst("dplyr_case_when")
```

## Criar novas colunas a partir dos dados

```{r}
#| results: 'asis'
#| echo: false
adicionar_arte_horst("parse_number")
```


## Transformar formato da base

![](images/original-dfs-tidy.png){fig-align="center"}

::: footer
Fonte:  [Garrick Aden-Buie (@grrrck) - Tidy Animated Verbs](https://github.com/gadenbuie/tidyexplain)
:::


## Transformar formato da base

![](https://github.com/gadenbuie/tidyexplain/raw/main/images/tidyr-pivoting.gif){fig-align="center"}

::: footer
Fonte:  [Garrick Aden-Buie (@grrrck) - Tidy Animated Verbs](https://github.com/gadenbuie/tidyexplain)
:::



## Aplicar uma transforma√ß√£o em v√°rias vari√°veis de uma vez

```{r}
#| results: 'asis'
#| echo: false
adicionar_arte_horst("dplyr_across")
```

## Melhorar a estrutura do resultado de um modelo

```{r}
#| results: 'asis'
#| echo: false
adicionar_arte_horst("broom_package")
```


## Onde aprender mais...
